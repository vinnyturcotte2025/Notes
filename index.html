<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Notes App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 700px;
        }

        /* Sidebar - Notebooks */
        .sidebar {
            width: 300px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 25px;
            overflow-y: auto;
        }

        .notebooks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .notebooks-header h2 {
            color: #1e293b;
            font-size: 1.5rem;
        }

        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .notebooks-list {
            list-style: none;
        }

        .notebook-item {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notebook-item:hover {
            border-color: #4f46e5;
            transform: translateX(5px);
        }

        .notebook-item.active {
            border-color: #4f46e5;
            background: #eef2ff;
        }

        .notebook-info h3 {
            color: #1e293b;
            margin-bottom: 5px;
        }

        .notebook-info p {
            color: #64748b;
            font-size: 0.9rem;
        }

        .notebook-count {
            background: #4f46e5;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* Main Content Area */
        .content-area {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .content-header h2 {
            color: #1e293b;
            font-size: 1.8rem;
        }

        .notes-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 30px;
        }

        .note-item {
            background: #f8fafc;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            border-left: 5px solid #4f46e5;
            transition: all 0.3s;
        }

        .note-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .note-date {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .note-content {
            color: #1e293b;
            line-height: 1.6;
            margin-bottom: 15px;
            max-height: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-actions {
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .note-item:hover .note-actions {
            opacity: 1;
        }

        .action-btn {
            background: #e2e8f0;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #cbd5e1;
        }

        .action-btn.delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .action-btn.delete:hover {
            background: #fecaca;
        }

        /* Voice Recorder Section */
        .voice-recorder {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #bae6fd;
        }

        .recorder-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .recorder-header h3 {
            color: #0369a1;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .waveform-container {
            height: 150px;
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }

        #waveform {
            width: 100%;
            height: 100%;
        }

        .recorder-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .record-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .record-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.4);
        }

        .record-btn.recording {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .save-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 15px 30px;
        }

        .status {
            text-align: center;
            margin-top: 15px;
            color: #64748b;
            font-weight: 500;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #1e293b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #475569;
        }

        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
            
            .content-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .recorder-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ðŸŽ¤ Voice Notes App</h1>
            <p>Record, organize, and manage your voice notes with live waveform visualization</p>
        </div>

        <div class="main-content">
            <!-- Sidebar with Notebooks -->
            <div class="sidebar">
                <div class="notebooks-header">
                    <h2>ðŸ““ Notebooks</h2>
                    <button class="btn" id="newNotebookBtn">+ New</button>
                </div>
                <ul class="notebooks-list" id="notebooksList">
                    <!-- Notebooks will be loaded here -->
                </ul>
            </div>

            <!-- Main Content Area -->
            <div class="content-area">
                <div class="content-header">
                    <h2 id="currentNotebookTitle">Select a Notebook</h2>
                    <div class="status" id="recordingStatus">Ready to record</div>
                </div>

                <div class="notes-list" id="notesList">
                    <!-- Notes will be loaded here -->
                    <div class="empty-state">
                        <h3>No notes yet</h3>
                        <p>Select a notebook and start recording to add your first voice note!</p>
                    </div>
                </div>

                <!-- Voice Recorder -->
                <div class="voice-recorder">
                    <div class="recorder-header">
                        <h3>ðŸŽ¤ Voice Recorder</h3>
                        <p>Click record to start capturing your voice note</p>
                    </div>
                    
                    <div class="waveform-container">
                        <canvas id="waveform"></canvas>
                    </div>

                    <div class="recorder-controls">
                        <button class="btn record-btn" id="recordBtn">
                            ðŸŽ¤
                        </button>
                        <button class="btn save-btn" id="saveBtn" disabled>
                            ðŸ’¾ Save Note
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for creating new notebook -->
    <div class="modal" id="notebookModal">
        <div class="modal-content">
            <h2>Create New Notebook</h2>
            <div class="form-group">
                <label for="notebookName">Notebook Name</label>
                <input type="text" id="notebookName" placeholder="Enter notebook name">
            </div>
            <div class="form-group">
                <label for="notebookDescription">Description (Optional)</label>
                <textarea id="notebookDescription" rows="3" placeholder="Add a description"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn" id="cancelBtn">Cancel</button>
                <button class="btn" id="createNotebookBtn">Create</button>
            </div>
        </div>
    </div>

    <!-- Modal for note transcription -->
    <div class="modal" id="transcriptionModal">
        <div class="modal-content">
            <h2>Review & Save Note</h2>
            <div class="form-group">
                <label for="noteTitle">Note Title</label>
                <input type="text" id="noteTitle" placeholder="Enter note title">
            </div>
            <div class="form-group">
                <label for="noteTranscription">Transcription (Edit if needed)</label>
                <textarea id="noteTranscription" rows="6" placeholder="Transcription will appear here..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn" id="cancelTranscriptionBtn">Cancel</button>
                <button class="btn" id="saveNoteBtn">Save Note</button>
            </div>
        </div>
    </div>

    <script>
        // App State
        const state = {
            currentNotebook: null,
            notebooks: JSON.parse(localStorage.getItem('voiceNotesNotebooks')) || [],
            isRecording: false,
            mediaRecorder: null,
            audioChunks: [],
            audioContext: null,
            analyser: null,
            dataArray: null,
            animationId: null,
            recordedAudio: null
        };

        // DOM Elements
        const notebooksList = document.getElementById('notebooksList');
        const notesList = document.getElementById('notesList');
        const currentNotebookTitle = document.getElementById('currentNotebookTitle');
        const recordBtn = document.getElementById('recordBtn');
        const saveBtn = document.getElementById('saveBtn');
        const waveformCanvas = document.getElementById('waveform');
        const recordingStatus = document.getElementById('recordingStatus');
        const notebookModal = document.getElementById('notebookModal');
        const transcriptionModal = document.getElementById('transcriptionModal');

        // Initialize App
        function initApp() {
            renderNotebooks();
            setupEventListeners();
            setupAudioVisualizer();
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Notebook buttons
            document.getElementById('newNotebookBtn').addEventListener('click', () => {
                document.getElementById('notebookName').value = '';
                document.getElementById('notebookDescription').value = '';
                notebookModal.style.display = 'flex';
            });

            document.getElementById('cancelBtn').addEventListener('click', () => {
                notebookModal.style.display = 'none';
            });

            document.getElementById('createNotebookBtn').addEventListener('click', createNotebook);

            // Transcription modal buttons
            document.getElementById('cancelTranscriptionBtn').addEventListener('click', () => {
                transcriptionModal.style.display = 'none';
            });

            document.getElementById('saveNoteBtn').addEventListener('click', saveNote);

            // Recording buttons
            recordBtn.addEventListener('click', toggleRecording);
            saveBtn.addEventListener('click', showTranscriptionModal);
        }

        // Notebook Functions
        function renderNotebooks() {
            notebooksList.innerHTML = '';
            
            if (state.notebooks.length === 0) {
                notebooksList.innerHTML = `
                    <div class="empty-state">
                        <h3>No notebooks yet</h3>
                        <p>Create your first notebook to get started!</p>
                    </div>
                `;
                return;
            }

            state.notebooks.forEach((notebook, index) => {
                const notebookItem = document.createElement('li');
                notebookItem.className = 'notebook-item';
                if (state.currentNotebook === index) {
                    notebookItem.classList.add('active');
                }
                
                notebookItem.innerHTML = `
                    <div class="notebook-info">
                        <h3>${notebook.name}</h3>
                        <p>${notebook.description || 'No description'}</p>
                    </div>
                    <span class="notebook-count">${notebook.notes.length}</span>
                `;
                
                notebookItem.addEventListener('click', () => selectNotebook(index));
                notebooksList.appendChild(notebookItem);
            });
        }

        function createNotebook() {
            const name = document.getElementById('notebookName').value.trim();
            const description = document.getElementById('notebookDescription').value.trim();

            if (!name) {
                alert('Please enter a notebook name');
                return;
            }

            const newNotebook = {
                id: Date.now(),
                name,
                description,
                created: new Date().toISOString(),
                notes: []
            };

            state.notebooks.push(newNotebook);
            saveToLocalStorage();
            renderNotebooks();
            notebookModal.style.display = 'none';
            
            // Select the new notebook
            selectNotebook(state.notebooks.length - 1);
        }

        function selectNotebook(index) {
            state.currentNotebook = index;
            renderNotebooks();
            renderNotes();
            
            const notebook = state.notebooks[index];
            currentNotebookTitle.textContent = `ðŸ“’ ${notebook.name}`;
            recordingStatus.textContent = `Ready to record in "${notebook.name}"`;
        }

        // Note Functions
        function renderNotes() {
            if (state.currentNotebook === null) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <h3>Select a Notebook</h3>
                        <p>Please select a notebook to view and add notes</p>
                    </div>
                `;
                return;
            }

            const notebook = state.notebooks[state.currentNotebook];
            
            if (notebook.notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <h3>No notes yet</h3>
                        <p>Start recording to add your first voice note!</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = '';
            notebook.notes.forEach((note, index) => {
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.innerHTML = `
                    <div class="note-date">${formatDate(note.created)}</div>
                    <h3>${note.title}</h3>
                    <div class="note-content">${note.transcription}</div>
                    <audio src="${note.audioUrl}" controls style="width: 100%; margin: 10px 0;"></audio>
                    <div class="note-actions">
                        <button class="action-btn delete" onclick="deleteNote(${index})">Delete</button>
                    </div>
                `;
                notesList.appendChild(noteItem);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function deleteNote(noteIndex) {
            if (confirm('Are you sure you want to delete this note?')) {
                state.notebooks[state.currentNotebook].notes.splice(noteIndex, 1);
                saveToLocalStorage();
                renderNotes();
                renderNotebooks();
            }
        }

        // Audio Recording Functions
        async function toggleRecording() {
            if (!state.isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });
                
                state.mediaRecorder = new MediaRecorder(stream);
                state.audioChunks = [];
                
                state.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        state.audioChunks.push(event.data);
                    }
                };
                
                state.mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(state.audioChunks, { type: 'audio/webm' });
                    state.recordedAudio = audioBlob;
                    saveBtn.disabled = false;
                    recordingStatus.textContent = 'Recording stopped. Ready to save.';
                    
                    // Stop visualization
                    cancelAnimationFrame(state.animationId);
                    drawSilentWaveform();
                };
                
                // Setup audio visualization
                setupAudioVisualizer(stream);
                
                state.mediaRecorder.start();
                state.isRecording = true;
                recordBtn.classList.add('recording');
                recordBtn.innerHTML = 'â¸ï¸';
                saveBtn.disabled = true;
                recordingStatus.textContent = 'Recording... Click stop when done';
                
            } catch (error) {
                console.error('Error accessing microphone:', error);
                alert('Could not access microphone. Please check permissions.');
            }
        }

        function stopRecording() {
            if (state.mediaRecorder && state.isRecording) {
                state.mediaRecorder.stop();
                state.isRecording = false;
                recordBtn.classList.remove('recording');
                recordBtn.innerHTML = 'ðŸŽ¤';
                
                // Stop all tracks
                state.mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }

        // Audio Visualization
        function setupAudioVisualizer(stream = null) {
            if (!state.audioContext) {
                state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            if (stream) {
                const source = state.audioContext.createMediaStreamSource(stream);
                state.analyser = state.audioContext.createAnalyser();
                source.connect(state.analyser);
                
                state.analyser.fftSize = 256;
                const bufferLength = state.analyser.frequencyBinCount;
                state.dataArray = new Uint8Array(bufferLength);
                
                drawWaveform();
            }
        }

        function drawWaveform() {
            if (!state.analyser || !state.dataArray) return;

            const canvas = waveformCanvas;
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            state.analyser.getByteTimeDomainData(state.dataArray);

            ctx.fillStyle = 'rgb(248, 250, 252)';
            ctx.fillRect(0, 0, width, height);

            ctx.lineWidth = 3;
            ctx.strokeStyle = 'rgb(79, 70, 229)';
            ctx.beginPath();

            const sliceWidth = width * 1.0 / state.dataArray.length;
            let x = 0;

            for (let i = 0; i < state.dataArray.length; i++) {
                const v = state.dataArray[i] / 128.0;
                const y = v * height / 2;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                x += sliceWidth;
            }

            ctx.lineTo(width, height / 2);
            ctx.stroke();

            // Add gradient fill
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, 'rgba(79, 70, 229, 0.3)');
            gradient.addColorStop(1, 'rgba(79, 70, 229, 0)');
            
            ctx.fillStyle = gradient;
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.fill();

            state.animationId = requestAnimationFrame(drawWaveform);
        }

        function drawSilentWaveform() {
            const canvas = waveformCanvas;
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            ctx.fillStyle = 'rgb(248, 250, 252)';
            ctx.fillRect(0, 0, width, height);

            // Draw a subtle baseline
            ctx.strokeStyle = 'rgba(79, 70, 229, 0.1)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        // Save Note Functions
        function showTranscriptionModal() {
            if (!state.recordedAudio) {
                alert('No recording to save!');
                return;
            }

            // In a real app, you would send the audio to a speech-to-text API
            // For this demo, we'll simulate transcription
            const simulatedTranscription = "This is a simulated transcription. In a real application, this would be generated by a speech-to-text service like Google Cloud Speech-to-Text or AWS Transcribe.";
            
            document.getElementById('noteTitle').value = `Voice Note ${new Date().toLocaleDateString()}`;
            document.getElementById('noteTranscription').value = simulatedTranscription;
            transcriptionModal.style.display = 'flex';
        }

        function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const transcription = document.getElementById('noteTranscription').value.trim();

            if (!title || !transcription) {
                alert('Please fill in all fields');
                return;
            }

            if (state.currentNotebook === null) {
                alert('Please select a notebook first');
                return;
            }

            // Convert audio blob to data URL
            const reader = new FileReader();
            reader.readAsDataURL(state.recordedAudio);
            reader.onloadend = () => {
                const audioUrl = reader.result;
                
                const newNote = {
                    id: Date.now(),
                    title,
                    transcription,
                    audioUrl,
                    created: new Date().toISOString(),
                    duration: Math.floor(state.audioChunks.length / 44100) // Simulated duration
                };

                state.notebooks[state.currentNotebook].notes.unshift(newNote);
                saveToLocalStorage();
                renderNotes();
                renderNotebooks();
                
                transcriptionModal.style.display = 'none';
                state.recordedAudio = null;
                saveBtn.disabled = true;
                recordingStatus.textContent = 'Note saved successfully!';
                
                // Reset after 3 seconds
                setTimeout(() => {
                    if (state.currentNotebook !== null) {
                        const notebook = state.notebooks[state.currentNotebook];
                        recordingStatus.textContent = `Ready to record in "${notebook.name}"`;
                    }
                }, 3000);
            };
        }

        // Utility Functions
        function saveToLocalStorage() {
            localStorage.setItem('voiceNotesNotebooks', JSON.stringify(state.notebooks));
        }

        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', initApp);
        window.addEventListener('resize', () => {
            if (!state.isRecording) {
                drawSilentWaveform();
            }
        });

        // Make deleteNote available globally
        window.deleteNote = deleteNote;

        // Draw initial silent waveform
        setTimeout(() => {
            drawSilentWaveform();
        }, 100);
    </script>
</body>
</html>
