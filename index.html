<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Notes by Enzo</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#020617">

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Notes by Enzo&quot;,
  &quot;short_name&quot;:&quot;EnzoNotes&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#020617&quot;,
  &quot;theme_color&quot;:&quot;#020617&quot;
}">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  background: #020617;
  color: #e5e7eb;
  font-family: Arial, Helvetica, sans-serif;
}
.app {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}
button, select, input {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}
textarea {
  width: 100%;
  height: 260px;
  background: transparent;
  color: #e5e7eb;
  border: 1px solid #334155;
  border-radius: 12px;
  padding: 12px;
}
canvas { width: 100%; height: 70px; }
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 8px;
}
.status {
  text-align: center;
  font-size: 0.85rem;
  color: #94a3b8;
}
</style>
</head>

<body>
<div class="app">
  <h1>Notes by Enzo</h1>

  <div class="controls">
    <button id="loginBtn">ğŸ” Login</button>
    <button id="logoutBtn" style="display:none">ğŸšª Logout</button>
    <select id="notebooks"></select>
    <button id="newNotebook">â• Notebook</button>
    <button id="startBtn">ğŸ™ Start</button>
    <button id="stopBtn">â¹ Stop</button>
    <button id="aiBtn">ğŸ§  Summarize</button>
  </div>

  <canvas id="wave"></canvas>
  <textarea id="notes"></textarea>

  <input id="apiKey" type="password" placeholder="AI API Key (optional)" />
  <div class="status" id="status">Idle</div>
</div>

<script>
/* ğŸ”¥ FIREBASE CONFIG â€” REPLACE ME */
firebase.initializeApp({
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ğŸ” AUTH */
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");

loginBtn.onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick = () => auth.signOut();

let user, currentNotebook;

/* ğŸ—‚ï¸ NOTEBOOKS */
const notebookSelect = document.getElementById("notebooks");
const notes = document.getElementById("notes");

auth.onAuthStateChanged(u => {
  if (!u) return;
  user = u;
  loginBtn.style.display = "none";
  logoutBtn.style.display = "inline";
  loadNotebooks();
});

function loadNotebooks() {
  db.collection("users").doc(user.uid).collection("notebooks")
    .onSnapshot(snap => {
      notebookSelect.innerHTML = "";
      snap.forEach(doc => {
        const opt = document.createElement("option");
        opt.value = doc.id;
        opt.textContent = doc.data().name;
        notebookSelect.appendChild(opt);
      });
      if (!currentNotebook && snap.docs[0])
        selectNotebook(snap.docs[0].id);
    });
}

function selectNotebook(id) {
  currentNotebook = id;
  db.collection("users").doc(user.uid)
    .collection("notebooks").doc(id)
    .onSnapshot(doc => {
      notes.value = doc.data().text || "";
    });
}

notebookSelect.onchange = e => selectNotebook(e.target.value);

document.getElementById("newNotebook").onclick = () => {
  const name = prompt("Notebook name?");
  if (!name) return;
  db.collection("users").doc(user.uid)
    .collection("notebooks").add({ name, text: "", updated: Date.now() });
};

/* â˜ï¸ REAL-TIME SAVE + HISTORY */
let saveTimer;
notes.oninput = () => {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => {
    const ref = db.collection("users").doc(user.uid)
      .collection("notebooks").doc(currentNotebook);

    ref.set({
      text: notes.value,
      updated: Date.now()
    }, { merge: true });

    ref.collection("history").add({
      text: notes.value,
      timestamp: Date.now()
    });
  }, 500);
};

/* ğŸ™ï¸ SPEECH */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.onresult = e => {
  notes.value += " " + e.results[e.results.length - 1][0].transcript + ".";
};

startBtn.onclick = () => recognition.start();
stopBtn.onclick = () => recognition.stop();

/* ğŸŒŠ WAVEFORM */
navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
  const ctx = new AudioContext();
  const analyser = ctx.createAnalyser();
  ctx.createMediaStreamSource(stream).connect(analyser);
  const canvas = document.getElementById("wave");
  const c = canvas.getContext("2d");
  const data = new Uint8Array(analyser.fftSize = 2048);

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteTimeDomainData(data);
    c.clearRect(0,0,canvas.width,canvas.height);
    c.beginPath();
    data.forEach((v,i)=> {
      const x = i / data.length * canvas.width;
      const y = v / 255 * canvas.height;
      i ? c.lineTo(x,y) : c.moveTo(x,y);
    });
    c.strokeStyle = "#2563eb";
    c.stroke();
  }
  draw();
});

/* ğŸ§  AI SUMMARY */
aiBtn.onclick = async () => {
  const key = apiKey.value.trim();
  if (!key) return alert("Add API key");
  const r = await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+key,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      model:"gpt-4o-mini",
      messages:[{role:"user",content:notes.value}]
    })
  });
  const d = await r.json();
  alert(d.choices[0].message.content);
};
</script>
</body>
</html>
