<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Notes by Enzo</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #020617;
    color: #e5e7eb;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .app {
    width: 95%;
    max-width: 900px;
    background: #020617;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 0 50px rgba(0,0,0,0.6);
  }

  h1 { text-align: center; margin-bottom: 6px; }
  .subtitle { text-align: center; color: #94a3b8; margin-bottom: 12px; }

  textarea {
    width: 100%;
    height: 260px;
    background: transparent;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 12px;
    resize: none;
  }

  canvas {
    width: 100%;
    height: 80px;
    margin: 10px 0;
  }

  .controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 10px;
  }

  button {
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    background: #2563eb;
    color: white;
    cursor: pointer;
  }

  .status {
    text-align: center;
    font-size: 0.85rem;
    color: #94a3b8;
    margin-top: 8px;
  }
</style>
</head>

<body>
<div class="app">
  <h1>Notes by Enzo</h1>
  <div class="subtitle">Local brain. Cloud memory.</div>

  <div class="controls">
    <button id="startBtn">üéô Start</button>
    <button id="stopBtn" disabled>‚èπ Stop</button>
  </div>

  <canvas id="waveform"></canvas>

  <textarea id="notes" placeholder="Your cloud-synced notes live here‚Ä¶"></textarea>

  <div class="status" id="status">Idle</div>
</div>

<script>
/* ---------- Firebase Config ---------- */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ---------- Device Identity ---------- */
let deviceId = localStorage.getItem("enzo-device");
if (!deviceId) {
  deviceId = crypto.randomUUID();
  localStorage.setItem("enzo-device", deviceId);
}

const docRef = db.collection("notes").doc(deviceId);

/* ---------- Elements ---------- */
const notes = document.getElementById("notes");
const statusText = document.getElementById("status");

/* ---------- Load From Cloud ---------- */
docRef.get().then(doc => {
  if (doc.exists) {
    notes.value = doc.data().text || "";
  }
});

/* ---------- Save To Cloud ---------- */
let saveTimeout;
notes.addEventListener("input", () => {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    docRef.set({
      text: notes.value,
      updated: firebase.firestore.FieldValue.serverTimestamp()
    });
    statusText.textContent = "Saved to cloud ‚òÅÔ∏è";
  }, 600);
});

/* ---------- Waveform ---------- */
const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");
let analyser, dataArray, audioCtx;

function drawWave() {
  requestAnimationFrame(drawWave);
  if (!analyser) return;

  analyser.getByteTimeDomainData(dataArray);
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = "#2563eb";
  ctx.beginPath();

  let slice = canvas.width / dataArray.length;
  let x = 0;

  for (let i = 0; i < dataArray.length; i++) {
    let y = (dataArray[i] / 128) * canvas.height / 2;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    x += slice;
  }

  ctx.stroke();
}

/* ---------- Speech ---------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.continuous = true;

recognition.onresult = e => {
  const text = e.results[e.results.length - 1][0].transcript.trim();
  notes.value += " " + text + ".";
};

startBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  audioCtx = new AudioContext();
  analyser = audioCtx.createAnalyser();
  audioCtx.createMediaStreamSource(stream).connect(analyser);

  analyser.fftSize = 2048;
  dataArray = new Uint8Array(analyser.fftSize);

  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;

  drawWave();
  recognition.start();

  statusText.textContent = "Listening‚Ä¶";
  startBtn.disabled = true;
  stopBtn.disabled = false;
};

stopBtn.onclick = () => {
  recognition.stop();
  audioCtx && audioCtx.close();
  analyser = null;
  statusText.textContent = "Stopped";
  startBtn.disabled = false;
  stopBtn.disabled = true;
};
</script>
</body>
</html>
